'use strict';
import { drawnObjects } from './landscape.js';
import { addImage } from './landscape.js';
import { reDraw } from './landscape.js';
import { drawPath } from './leftButtons.js';
import { plot } from './plotsSizes.js';
import { currentUser } from './topButtons.js';
import { ways } from './leftButtons.js';

let ajaxHandlerScript = 'https://fe.it-academy.by/AjaxStringStorage2.php';
let updatePassword;

let stringName = 'MIASNIKOVA_LANDSKAPE_OBJECTS';

// let stringName = 'MIASNIKOVA_LANDSKAPE_TEMPLATES';

// export function storeInfo() {
//   updatePassword = Math.random();
//   $.ajax({
//     url: ajaxHandlerScript,
//     type: 'POST',
//     cache: false,
//     dataType: 'json',
//     data: { f: 'LOCKGET', n: stringName, p: updatePassword },
//     success: lockGetReady,
//     error: errorHandler,
//   });
// }

// function lockGetReady(callresult) {
//   if (callresult.error != undefined) alert(callresult.error);
//   else {
//     let templates = {
//       templ1: {
//         '1': ['pavement', 6, 0.303, 0.376, 5.882, 5.882, 1, 1, 0],
//         '2': ['cars', 2, 0.312, 0.421, 7.205, 3.235, 0.539, 0.539, 0],
//         '3': ['trees', 5, 0.291, 0.204, 3.529, 3.529, 2.6, 2.6, 0],
//         '4': ['shrubs', 13, 0.397, 0.611, 2.352, 2.352, 0.96, 0.96, 0],
//         '5': ['shrubs', 13, 0.445, 0.741, 2.352, 2.352, 1, 1, 0],
//         '6': [
//           'shrubs',
//           13,
//           0.444,
//           0.61,
//           2.352,
//           2.352,
//           1,
//           1,
//           0.44514990510687147,
//         ],
//         '7': ['shrubs', 13, 0.445, 0.677, 2.352, 2.352, 1, 1, 0],
//         '8': [
//           'shrubs',
//           13,
//           0.397,
//           0.674,
//           2.352,
//           2.352,
//           1,
//           1,
//           3.0966516225575402,
//         ],
//         '9': ['shrubs', 13, 0.398, 0.744, 2.352, 2.352, 1, 1, 0],
//         '10': ['trees', 11, 0.495, 0.746, 3.529, 3.529, 0.659, 0.659, 0],
//         '11': [
//           'trees',
//           11,
//           0.495,
//           0.689,
//           3.529,
//           3.529,
//           0.619,
//           0.599,
//           3.0894778619204057,
//         ],
//         '12': ['trees', 11, 0.495, 0.638, 3.529, 3.529, 0.579, 0.579, 0],
//         '13': ['trees', 11, 0.493, 0.586, 3.529, 3.529, 0.619, 0.619, 0],
//         '14': ['flowers', 1, 0.634, 0.675, 3.529, 3.529, 1, 1, 0],
//         '15': ['flowers', 1, 0.531, 0.747, 3.529, 3.529, 1, 1, 0],
//         '16': ['flowers', 1, 0.6, 0.612, 3.529, 3.529, 1, 1, 0],
//         '17': ['flowers', 1, 0.566, 0.673, 3.529, 3.529, 1, 1, 0],
//         '18': ['flowers', 1, 0.6, 0.643, 3.529, 3.529, 1, 1, 0],
//         '19': ['flowers', 1, 0.596, 0.572, 3.529, 3.529, 1, 1, 0],
//         '20': ['flowers', 1, 0.529, 0.643, 3.529, 3.529, 1, 1, 0],
//         '21': ['flowers', 1, 0.6, 0.675, 3.529, 3.529, 1, 1, 0],
//         '22': ['flowers', 1, 0.628, 0.571, 3.529, 3.529, 1, 1, 0],
//         '23': ['flowers', 1, 0.635, 0.613, 3.529, 3.529, 1, 1, 0],
//         '24': ['flowers', 1, 0.565, 0.641, 3.529, 3.529, 1, 1, 0],
//         '25': ['flowers', 1, 0.597, 0.745, 3.529, 3.529, 1, 1, 0],
//         '26': ['flowers', 1, 0.597, 0.709, 3.529, 3.529, 1, 1, 0],
//         '27': ['flowers', 1, 0.528, 0.574, 3.529, 3.529, 1, 1, 0],
//         '28': ['flowers', 1, 0.633, 0.711, 3.529, 3.529, 1, 1, 0],
//         '29': ['flowers', 1, 0.563, 0.574, 3.529, 3.529, 1, 1, 0],
//         '30': ['flowers', 1, 0.565, 0.614, 3.529, 3.529, 1, 1, 0],
//         '31': [
//           'flowers',
//           1,
//           0.634,
//           0.643,
//           3.529,
//           3.529,
//           1,
//           0.96,
//           0.012000234919467001,
//         ],
//         '32': ['flowers', 1, 0.633, 0.743, 3.529, 3.529, 1, 1, 0],
//         '33': ['flowers', 1, 0.531, 0.614, 3.529, 3.529, 1, 1, 0],
//         '34': ['flowers', 1, 0.529, 0.675, 3.529, 3.529, 1, 1, 0],
//         '35': ['flowers', 1, 0.529, 0.711, 3.529, 3.529, 1, 1, 0],
//         '36': ['flowers', 1, 0.565, 0.709, 3.529, 3.529, 1, 1, 0],
//         '37': ['flowers', 1, 0.566, 0.743, 3.529, 3.529, 1, 1, 0],
//         '38': ['trees', 1, 0.618, 0.451, 3.529, 3.529, 1, 1, 0],
//         '39': ['trees', 1, 0.606, 0.327, 3.529, 3.529, 0.98, 1, 0],
//         '40': ['trees', 1, 0.541, 0.227, 3.529, 3.529, 1, 1, 0],
//         '41': ['trees', 1, 0.518, 0.413, 3.529, 3.529, 1.06, 1.06, 0],
//         '42': ['trees', 4, 0.31, 0.723, 3.529, 3.529, 1, 1, 0],
//         '43': ['trees', 4, 0.631, 0.206, 3.529, 3.529, 1, 1, 0],
//         '44': ['trees', 4, 0.306, 0.579, 3.529, 3.529, 1, 1, 0],
//         '45': ['pavement', 11, 0.429, 0.232, 5.882, 5.882, 1, 1, 0],
//         '46': ['houses', 2, 0.377, 0.359, 10.117, 8, 1, 1, 0],
//         '47': ['shrubs', 1, 0.316, 0.661, 2.352, 2.352, 1, 1, 0],
//         '48': ['shrubs', 1, 0.373, 0.572, 2.352, 2.352, 1, 1, 0],
//         '49': ['shrubs', 1, 0.398, 0.193, 2.352, 2.352, 1, 1, 0],
//         '50': ['shrubs', 1, 0.314, 0.504, 2.352, 2.352, 1, 1, 0],
//         '51': ['shrubs', 1, 0.587, 0.479, 2.352, 2.352, 1, 1, 0],
//         '52': ['shrubs', 1, 0.569, 0.31, 2.352, 2.352, 1, 1, 0],
//         '53': [
//           'shrubs',
//           1,
//           0.513,
//           0.364,
//           2.352,
//           2.352,
//           1.04,
//           1,
//           1.2097066876228446,
//         ],
//         '54': ['shrubs', 1, 0.501, 0.188, 2.352, 2.352, 1, 1, 0],
//         '55': [
//           'furniture',
//           3,
//           0.44,
//           0.251,
//           5.882,
//           5.882,
//           0.6990000000000001,
//           0.6990000000000001,
//           0.7121175517824453,
//         ],
//         '56': ['flowers', 2, 0.539, 0.512, 3.529, 3.529, 0.599, 0.599, 0],
//         '57': ['flowers', 2, 0.592, 0.404, 3.529, 3.529, 0.639, 0.639, 0],
//         '58': ['flowers', 2, 0.408, 0.263, 3.529, 3.529, 0.519, 0.519, 0],
//         '59': ['flowers', 2, 0.505, 0.286, 3.529, 3.529, 0.559, 0.559, 0],
//         '60': ['flowers', 2, 0.358, 0.713, 3.529, 3.529, 0.619, 0.619, 0],
//         pl: { W: '30', H: '30', X: 0.302, Y: 0.176, ratio: 0.65, scale: 17 },
//         path: [
//           {
//             pattern: {},
//             number: 6,
//             coord: [
//               [0.3676991492652746, 0.499],
//               [0.3676991492652746, 0.716],
//             ],
//             downCoord: [
//               [0.3676991492652746, 0.499],
//               [0.3676991492652746, 0.716],
//             ],
//             way: {},
//           },
//           {
//             pattern: {},
//             number: 6,
//             coord: [
//               [0.37179273008507346, 0.5660697084917617],
//               [0.6367927300850735, 0.5660697084917617],
//             ],
//             downCoord: [
//               [0.37179273008507346, 0.5660697084917617],
//               [0.6367927300850735, 0.5660697084917617],
//             ],
//             way: {},
//           },
//           {
//             pattern: {},
//             number: 6,
//             coord: [
//               [740, 439],
//               [764, 350],
//             ],
//             downCoord: [
//               [740, 439],
//               [764, 350],
//             ],
//             way: {},
//           },
//           {
//             pattern: {},
//             number: 6,
//             coord: [
//               [767, 362],
//               [720, 289],
//             ],
//             downCoord: [
//               [767, 362],
//               [720, 289],
//             ],
//             way: {},
//           },
//           {
//             pattern: {},
//             number: 6,
//             coord: [
//               [719, 290],
//               [653, 259],
//             ],
//             downCoord: [
//               [719, 290],
//               [653, 259],
//             ],
//             way: {},
//           },
//           {
//             pattern: {},
//             number: 6,
//             coord: [
//               [0.5784996133023976, 0.5602027883396705],
//               [0.5784996133023976, 0.40304182509505704],
//             ],
//             downCoord: [
//               [0.5784996133023976, 0.5602027883396705],
//               [0.5784996133023976, 0.40304182509505704],
//             ],
//             way: {},
//           },
//           {
//             pattern: {},
//             number: 6,
//             coord: [
//               [0.5050270688321733, 0.34474017743979724],
//               [0.5413766434648106, 0.36248415716096327],
//             ],
//             downCoord: [
//               [0.5050270688321733, 0.34474017743979724],
//               [0.5413766434648106, 0.36248415716096327],
//             ],
//             way: {},
//           },
//           {
//             pattern: {},
//             number: 6,
//             coord: [
//               [0.5359628770301624, 0.35868187579214195],
//               [0.5815931941221965, 0.4055766793409379],
//             ],
//             downCoord: [
//               [0.5359628770301624, 0.35868187579214195],
//               [0.5815931941221965, 0.4055766793409379],
//             ],
//             way: {},
//           },
//         ],
//       },
//       templ2: {
//         '1': [
//           'houses',
//           1,
//           0.401,
//           0.234,
//           8.6,
//           6.8,
//           1.4800000000000004,
//           1.2600000000000002,
//           0,
//         ],
//         '2': ['pavement', 10, 0.462, 0.439, 5, 5, 1, 1, 0],
//         '3': ['pavement', 10, 0.461, 0.562, 5, 5, 1, 1, 0],
//         '4': ['pavement', 10, 0.387, 0.687, 5, 5, 1, 1, 0],
//         '5': ['pavement', 10, 0.537, 0.687, 5, 5, 1, 1, 0],
//         '6': ['pavement', 10, 0.462, 0.688, 5, 5, 1, 1, 0],
//         '7': [
//           'cars',
//           1,
//           0.394,
//           0.73,
//           6.125,
//           2.75,
//           0.6799999999999997,
//           0.6799999999999997,
//           -1.5688928908194457,
//         ],
//         '8': [
//           'cars',
//           3,
//           0.454,
//           0.688,
//           6.125,
//           2.75,
//           0.6799999999999997,
//           0.6799999999999997,
//           4.701649709649304,
//         ],
//         '9': ['scooters', 2, 0.57, 0.711, 2.5, 1.5, 1, 1, 4.407218190964354],
//         '10': ['scooters', 1, 0.545, 0.751, 2.5, 1.5, 1, 1, 4.257269311268511],
//         '11': ['shrubs', 14, 0.614, 0.764, 2, 2, 1, 1, 0],
//         '12': ['shrubs', 14, 0.616, 0.703, 2, 2, 1, 1, 0],
//         '13': ['shrubs', 14, 0.609, 0.645, 2, 2, 1, 1, 0],
//         '14': ['shrubs', 14, 0.573, 0.642, 2, 2, 1, 1, 0],
//         '15': ['shrubs', 14, 0.542, 0.645, 2, 2, 1, 1, 0],
//         '16': ['shrubs', 14, 0.542, 0.57, 2, 2, 1, 1, 3.356357391729069],
//         '17': ['shrubs', 14, 0.542, 0.508, 2, 2, 1, 1, 3.071626869573687],
//         '18': ['shrubs', 14, 0.432, 0.504, 2, 2, 1, 1, 0],
//         '19': ['shrubs', 14, 0.431, 0.591, 2, 2, 1, 1, 0.14587911419359045],
//         '20': ['shrubs', 14, 0.357, 0.77, 2, 2, 1, 1, 0],
//         '21': ['shrubs', 14, 0.357, 0.713, 2, 2, 1, 1, 0],
//         '22': ['shrubs', 14, 0.36, 0.648, 2, 2, 1, 1, 0],
//         '23': ['shrubs', 14, 0.395, 0.645, 2, 2, 1, 1, 0],
//         '24': ['shrubs', 14, 0.433, 0.645, 2, 2, 1, 1, 0],
//         '25': [
//           'pools',
//           1,
//           0.593,
//           0.344,
//           6,
//           6,
//           2.200000000000001,
//           1.04,
//           4.711048791521092,
//         ],
//         '26': ['shrubs', 14, 0.364, 0.407, 2, 2, 1, 1, 0],
//         '27': ['shrubs', 14, 0.297, 0.266, 2, 2, 1, 1, 0],
//         '28': ['shrubs', 14, 0.658, 0.186, 2, 2, 1, 1, 0],
//         '29': ['shrubs', 14, 0.697, 0.187, 2, 2, 1, 1, 0],
//         '30': ['shrubs', 14, 0.675, 0.773, 2, 2, 1, 1, 0],
//         '31': ['shrubs', 14, 0.579, 0.508, 2, 2, 1, 1, 0],
//         '32': ['shrubs', 14, 0.735, 0.192, 2, 2, 1, 1, 0],
//         '33': ['shrubs', 14, 0.61, 0.507, 2, 2, 1, 1, 0],
//         '34': ['shrubs', 14, 0.621, 0.19, 2, 2, 1.02, 1.02, 0],
//         '35': ['shrubs', 14, 0.621, 0.279, 2, 2, 1, 1, 0],
//         '36': ['shrubs', 14, 0.62, 0.344, 2, 2, 1, 1, -0.1908567578901228],
//         '37': ['shrubs', 14, 0.62, 0.409, 2, 2, 1, 1, 0],
//         '38': ['shrubs', 14, 0.737, 0.269, 2, 2, 1, 1, 0],
//         '39': ['shrubs', 14, 0.735, 0.34, 2, 2, 1, 1, 0],
//         '40': ['shrubs', 14, 0.733, 0.409, 2, 2, 1, 1, 0],
//         '41': ['shrubs', 14, 0.734, 0.477, 2, 2, 1, 1, 0],
//         '42': ['shrubs', 14, 0.737, 0.548, 2, 2, 1, 1, 0],
//         '43': [
//           'trees',
//           9,
//           0.222,
//           0.179,
//           3,
//           3,
//           1.5400000000000005,
//           1.5400000000000005,
//           0.7948514049015913,
//         ],
//         '44': [
//           'trees',
//           9,
//           0.641,
//           0.632,
//           3,
//           3,
//           1.2600000000000002,
//           1.2600000000000002,
//           -0.9692416566883582,
//         ],
//         '45': [
//           'trees',
//           9,
//           0.702,
//           0.629,
//           3,
//           3,
//           1.7600000000000007,
//           1.6400000000000006,
//           0,
//         ],
//         '46': ['angular', 2, 0.354, 0.211, 2, 2, 1, 1, 0],
//         '47': [
//           'angular',
//           3,
//           0.259,
//           0.409,
//           2,
//           2,
//           0.6199999999999997,
//           0.6199999999999997,
//           0,
//         ],
//         '48': [
//           'angular',
//           13,
//           0.699,
//           0.728,
//           2,
//           2,
//           0.6799999999999997,
//           0.6799999999999997,
//           0,
//         ],
//         '49': [
//           'angular',
//           14,
//           0.651,
//           0.746,
//           2,
//           2,
//           0.6599999999999997,
//           0.6599999999999997,
//           0,
//         ],
//         '50': [
//           'angular',
//           15,
//           0.729,
//           0.76,
//           2,
//           2,
//           0.8799999999999999,
//           0.8799999999999999,
//           0,
//         ],
//         '51': ['angular', 16, 0.578, 0.578, 2, 2, 1, 1, 0],
//         '52': [
//           'angular',
//           17,
//           0.694,
//           0.631,
//           2,
//           2,
//           0.7399999999999998,
//           0.7399999999999998,
//           0,
//         ],
//         '53': ['pavement', 10, 0.326, 0.273, 5, 5, 1, 1, 0],
//         '54': ['pavement', 10, 0.282, 0.396, 5, 5, 1, 1, 0],
//         '55': ['fountains', 1, 0.274, 0.319, 4, 4, 1, 1, 0],
//         '56': ['pavement', 10, 0.282, 0.522, 5, 5, 1, 1, 0],
//         '57': [
//           'furniture',
//           1,
//           0.291,
//           0.461,
//           5,
//           5,
//           0.7199999999999998,
//           0.7199999999999998,
//           0,
//         ],
//         '58': [
//           'flowers',
//           2,
//           0.364,
//           0.497,
//           3,
//           3,
//           0.6199999999999997,
//           0.6199999999999997,
//           3.4018257535357117,
//         ],
//         '59': [
//           'flowers',
//           2,
//           0.266,
//           0.276,
//           3,
//           3,
//           0.6599999999999997,
//           0.6599999999999997,
//           -1.044402591638768,
//         ],
//         '60': [
//           'flowers',
//           2,
//           0.246,
//           0.354,
//           3,
//           3,
//           0.6199999999999997,
//           0.6199999999999997,
//           0,
//         ],
//         '61': [
//           'flowers',
//           2,
//           0.246,
//           0.481,
//           3,
//           3,
//           0.6599999999999997,
//           0.6399999999999997,
//           0,
//         ],
//         '62': [
//           'flowers',
//           2,
//           0.249,
//           0.59,
//           3,
//           3,
//           0.6399999999999997,
//           0.6399999999999997,
//           0,
//         ],
//         '63': [
//           'flowers',
//           2,
//           0.612,
//           0.603,
//           3,
//           3,
//           0.6399999999999997,
//           0.6399999999999997,
//           3.1323254086471586,
//         ],
//         '64': ['houses', 2, 0.227, 0.645, 8.6, 6.8, 1, 1, 0],
//         '65': [
//           'trees',
//           7,
//           0.34,
//           0.5,
//           3,
//           3,
//           2.5400000000000014,
//           2.5200000000000014,
//           0,
//         ],
//         '66': [
//           'trees',
//           10,
//           0.496,
//           0.156,
//           3,
//           3,
//           1.9000000000000008,
//           1.8200000000000007,
//           0,
//         ],
//         pl: { W: '35', H: '25', X: 0.229, Y: 0.183, ratio: 0.65, scale: 20 },
//         path: [
//           {
//             pattern: {},
//             number: 10,
//             coord: [
//               [0.5274555297757154, 0.48542458808618505],
//               [0.6535189481825213, 0.48542458808618505],
//             ],
//             downCoord: [
//               [0.5274555297757154, 0.48542458808618505],
//               [0.6535189481825213, 0.48542458808618505],
//             ],
//             way: {},
//           },
//           {
//             pattern: {},
//             number: 10,
//             coord: [
//               [0.6109822119102861, 0.20405576679340937],
//               [0.6133023975251354, 0.48542458808618505],
//             ],
//             downCoord: [
//               [0.6109822119102861, 0.20405576679340937],
//               [0.6133023975251354, 0.48542458808618505],
//             ],
//             way: {},
//           },
//           {
//             pattern: {},
//             number: 10,
//             coord: [
//               [0.6457849961330241, 0.48542458808618505],
//               [0.6450116009280742, 0.6134347275031685],
//             ],
//             downCoord: [
//               [0.6457849961330241, 0.48542458808618505],
//               [0.6450116009280742, 0.6134347275031685],
//             ],
//             way: {},
//           },
//           {
//             pattern: {},
//             number: 10,
//             coord: [
//               [0.6473317865429234, 0.6020278833967047],
//               [0.7416860015467904, 0.6045627376425855],
//             ],
//             downCoord: [
//               [0.6473317865429234, 0.6020278833967047],
//               [0.7416860015467904, 0.6045627376425855],
//             ],
//             way: {},
//           },
//           {
//             pattern: {},
//             number: 10,
//             coord: [
//               [0.6179427687548337, 0.24081115335868186],
//               [0.7470997679814385, 0.24334600760456274],
//             ],
//             downCoord: [
//               [0.6179427687548337, 0.24081115335868186],
//               [0.7470997679814385, 0.24334600760456274],
//             ],
//             way: {},
//           },
//           {
//             pattern: {},
//             number: 10,
//             coord: [
//               [0.354215003866976, 0.4803548795944233],
//               [0.4717710750193349, 0.4752851711026616],
//             ],
//             downCoord: [
//               [0.354215003866976, 0.4803548795944233],
//               [0.4717710750193349, 0.4752851711026616],
//             ],
//             way: {},
//           },
//         ],
//       },
//       templ3: {
//         '1': [
//           'houses',
//           2,
//           0.461,
//           0.336,
//           8.6,
//           6.8,
//           1.3400000000000003,
//           1.3400000000000003,
//           -1.5676289391428329,
//         ],
//         '2': ['houses', 1, 0.614, 0.423, 8.6, 6.8, 1.2000000000000002, 0.98, 0],
//         '3': ['pavement', 9, 0.616, 0.184, 5, 5, 1, 1, 0],
//         '4': ['pavement', 9, 0.693, 0.307, 5, 5, 1, 1, 0],
//         '5': ['pavement', 9, 0.538, 0.184, 5, 5, 1, 1, 0],
//         '6': ['pavement', 9, 0.692, 0.182, 5, 5, 1, 1, 0],
//         '7': ['pavement', 9, 0.615, 0.304, 5, 5, 1, 1, 0],
//         '8': ['trees', 2, 0.767, 0.76, 3, 3, 1, 1, 0],
//         '9': ['trees', 2, 0.767, 0.7, 3, 3, 1, 1, 0],
//         '10': ['trees', 2, 0.769, 0.633, 3, 3, 1, 1, 0],
//         '11': ['trees', 2, 0.77, 0.566, 3, 3, 1, 1, 3.019676811265189],
//         '12': ['trees', 2, 0.768, 0.496, 3, 3, 1, 1, 0],
//         '13': ['trees', 2, 0.769, 0.424, 3, 3, 1, 1, 3.066463581987753],
//         '14': ['trees', 2, 0.767, 0.351, 3, 3, 1, 1, 0],
//         '15': ['trees', 2, 0.183, 0.114, 3, 3, 1, 1, 0],
//         '16': ['trees', 2, 0.766, 0.272, 3, 3, 1, 1, 3.0343905716103103],
//         '17': ['trees', 2, 0.765, 0.195, 3, 3, 1, 1, 0],
//         '18': ['trees', 2, 0.723, 0.11, 3, 3, 1, 1, 0],
//         '19': ['trees', 2, 0.767, 0.116, 3, 3, 1, 1, 3.420896810898819],
//         '20': ['trees', 2, 0.58, 0.118, 3, 3, 1, 1, 0],
//         '21': ['trees', 2, 0.537, 0.118, 3, 3, 1, 1, 0],
//         '22': ['trees', 2, 0.494, 0.116, 3, 3, 1, 1, 0],
//         '23': ['trees', 2, 0.45, 0.115, 3, 3, 1, 1, 0],
//         '24': ['trees', 2, 0.406, 0.111, 3, 3, 1, 1, 0],
//         '25': ['trees', 2, 0.358, 0.112, 3, 3, 1, 1, 0],
//         '26': ['trees', 2, 0.312, 0.111, 3, 3, 1, 1, 0],
//         '27': ['trees', 2, 0.266, 0.112, 3, 3, 1, 1, 0],
//         '28': ['trees', 2, 0.223, 0.11, 3, 3, 0.98, 1, 0],
//         '29': [
//           'cars',
//           1,
//           0.62,
//           0.28,
//           6.125,
//           2.75,
//           0.6799999999999997,
//           0.6799999999999997,
//           1.7654553374958475,
//         ],
//         '30': [
//           'cars',
//           3,
//           0.686,
//           0.251,
//           6.125,
//           2.75,
//           0.6999999999999997,
//           0.6999999999999997,
//           1.2611911897827153,
//         ],
//         '31': [
//           'trees',
//           8,
//           0.599,
//           0.716,
//           3,
//           3,
//           1.5200000000000005,
//           1.5200000000000005,
//           0,
//         ],
//         '32': [
//           'trees',
//           8,
//           0.326,
//           0.716,
//           3,
//           3,
//           1.4600000000000004,
//           1.4600000000000004,
//           0,
//         ],
//         '33': [
//           'trees',
//           8,
//           0.412,
//           0.715,
//           3,
//           3,
//           1.5800000000000005,
//           1.5800000000000005,
//           -0.22012338568779066,
//         ],
//         '34': [
//           'trees',
//           8,
//           0.69,
//           0.716,
//           3,
//           3,
//           1.5000000000000004,
//           1.5000000000000004,
//           0,
//         ],
//         '35': [
//           'trees',
//           8,
//           0.504,
//           0.717,
//           3,
//           3,
//           1.4800000000000004,
//           1.4800000000000004,
//           0.5478273977704009,
//         ],
//         '36': ['trees', 16, 0.546, 0.623, 3, 3, 1, 1, 0],
//         '37': ['trees', 16, 0.478, 0.622, 3, 3, 0.94, 0.94, 0],
//         '38': [
//           'trees',
//           8,
//           0.239,
//           0.716,
//           3,
//           3,
//           1.5200000000000005,
//           1.5200000000000005,
//           0,
//         ],
//         '39': ['trees', 16, 0.699, 0.622, 3, 3, 1, 1, 0],
//         '40': ['trees', 16, 0.622, 0.622, 3, 3, 1, 1, 0],
//         '41': ['ponds', 2, 0.307, 0.427, 6, 6, 1.3200000000000003, 1.02, 0],
//         '42': ['pavement', 2, 0.29, 0.585, 5, 5, 1, 1, 0],
//         '43': ['pavement', 2, 0.367, 0.585, 5, 5, 1, 1, 0],
//         '44': [
//           'trees',
//           18,
//           0.23,
//           0.469,
//           3,
//           3,
//           1.8800000000000008,
//           1.8800000000000008,
//           0,
//         ],
//         '45': [
//           'furniture',
//           1,
//           0.335,
//           0.597,
//           5,
//           5,
//           0.8999999999999999,
//           0.8999999999999999,
//           -0.474644781058565,
//         ],
//         '46': ['shrubs', 4, 0.317, 0.384, 2, 2, 1, 1, 0],
//         '47': ['shrubs', 4, 0.41, 0.541, 2, 2, 1, 1, 0],
//         '48': ['shrubs', 4, 0.307, 0.538, 2, 2, 1, 1, 0],
//         '49': [
//           'trees',
//           18,
//           0.237,
//           0.347,
//           3,
//           3,
//           1.6000000000000005,
//           1.6000000000000005,
//           0,
//         ],
//         '50': [
//           'trees',
//           13,
//           0.348,
//           0.21,
//           3,
//           3,
//           3.7400000000000024,
//           3.7400000000000024,
//           0,
//         ],
//         '51': [
//           'flowers',
//           2,
//           0.237,
//           0.192,
//           3,
//           3,
//           0.6599999999999997,
//           0.5999999999999996,
//           0,
//         ],
//         '52': [
//           'flowers',
//           2,
//           0.246,
//           0.629,
//           3,
//           3,
//           0.7399999999999998,
//           0.7199999999999998,
//           0,
//         ],
//         '53': [
//           'flowers',
//           2,
//           0.372,
//           0.189,
//           3,
//           3,
//           0.6799999999999997,
//           0.6799999999999997,
//           0,
//         ],
//         '54': [
//           'flowers',
//           2,
//           0.328,
//           0.244,
//           3,
//           3,
//           0.6599999999999997,
//           0.6199999999999997,
//           0,
//         ],
//         '55': [
//           'flowers',
//           2,
//           0.264,
//           0.243,
//           3,
//           3,
//           0.6799999999999997,
//           0.6799999999999997,
//           0,
//         ],
//         '56': [
//           'flowers',
//           2,
//           0.296,
//           0.2,
//           3,
//           3,
//           0.6799999999999997,
//           0.6799999999999997,
//           0,
//         ],
//         pl: { W: '35', H: '25', X: 0.229, Y: 0.183, ratio: 0.65, scale: 20 },
//         path: [
//           {
//             pattern: {},
//             number: 2,
//             coord: [
//               [0.4547563805104408, 0.7021546261089987],
//               [0.7648878576952821, 0.7021546261089987],
//             ],
//             downCoord: [
//               [0.4547563805104408, 0.7021546261089987],
//               [0.7648878576952821, 0.7021546261089987],
//             ],
//             way: {},
//           },
//           {
//             pattern: {},
//             number: 2,
//             coord: [
//               [0.45707656612529, 0.6070975918884665],
//               [0.7664346481051817, 0.6108998732572877],
//             ],
//             downCoord: [
//               [0.45707656612529, 0.6070975918884665],
//               [0.7664346481051817, 0.6108998732572877],
//             ],
//             way: {},
//           },
//           {
//             pattern: {},
//             number: 2,
//             coord: [
//               [0.4508894044856922, 0.5564005069708492],
//               [0.45166279969064194, 0.7122940430925222],
//             ],
//             downCoord: [
//               [0.4508894044856922, 0.5564005069708492],
//               [0.45166279969064194, 0.7122940430925222],
//             ],
//             way: {},
//           },
//           {
//             pattern: {},
//             number: 2,
//             coord: [
//               [0.4508894044856922, 0.5690747782002534],
//               [0.45011600928074247, 0.4803548795944234],
//             ],
//             downCoord: [
//               [0.4508894044856922, 0.5690747782002534],
//               [0.45011600928074247, 0.4803548795944234],
//             ],
//             way: {},
//           },
//         ],
//       },
//       templ4: {},
//     };
//     $.ajax({
//       url: ajaxHandlerScript,
//       type: 'POST',
//       cache: false,
//       dataType: 'json',
//       data: {
//         f: 'UPDATE',
//         n: stringName,
//         v: JSON.stringify(templates),
//         p: updatePassword,
//       },
//       success: updateReady,
//       error: errorHandler,
//     });
//   }
// }

// function updateReady(callresult) {
//   if (callresult.error != undefined) alert(callresult.error);
// }

// ///////////////////////////////////////////

let savedLast;
let allUsers = [];

export function storeInfo() {
  updatePassword = Math.random();
  $.ajax({
    url: ajaxHandlerScript,
    type: 'POST',
    cache: false,
    dataType: 'json',
    data: { f: 'LOCKGET', n: stringName, p: updatePassword },
    success: lockGetReady,
    error: errorHandler,
  });
}

function lockGetReady(callresult) {
  if (callresult.error != undefined) alert(callresult.error);
  else {
    $.ajax({
      url: ajaxHandlerScript,
      type: 'POST',
      cache: false,
      dataType: 'json',
      data: { f: 'READ', n: stringName },
      success: read,
      error: errorHandler,
    });

    function read() {
      if (callresult.error != undefined) alert(callresult.error);
      else if (callresult.result != '') {
        savedLast = JSON.parse(callresult.result);
        allUsers = savedLast;
        // allUsers = [];
        updateData();
      }
    }

    function updateData() {
      let i = 1;
      let info = {};
      info.pl = plot;
      info.path = ways;
      for (let item of drawnObjects) {
        info[i] = [
          item.s,
          item.num,
          item.Xshare,
          item.Yshare,
          item.widthShare,
          item.heightShare,
          item.selectX,
          item.selectY,
          item.angle,
        ];
        i++;
      }
      let user = { userData: currentUser, userInfo: info };

      let is = true;
      if (!savedLast[0]) {
        allUsers.push(user);
      } else {
        for (let item of allUsers) {
                     if (JSON.stringify(item.userData) !== JSON.stringify(currentUser)) {
              is = false;
            } else {
              item.userInfo = user.userInfo;
              is = true;
                     }
        }
        addNewUser();
      }

      function addNewUser() {
        if (!is) {
          allUsers.push(user);
        }
      }

      $.ajax({
        url: ajaxHandlerScript,
        type: 'POST',
        cache: false,
        dataType: 'json',
        data: {
          f: 'UPDATE',
          n: stringName,
          v: JSON.stringify(allUsers),
          p: updatePassword,
        },
        success: updateReady,
        error: errorHandler,
      });
    }
  }
}
function updateReady(callresult) {
  if (callresult.error != undefined) alert(callresult.error);
}

let savedObjects = [];

export function restoreInfo() {
    $.ajax({
      url: ajaxHandlerScript,
      type: 'POST',
      cache: false,
      dataType: 'json',
      data: { f: 'READ', n: stringName },
      success: readReady,
      error: errorHandler,
    });
}

function readReady(callresult) {
  if (callresult.error != undefined) alert(callresult.error);
  else if (callresult.result != '') {
    savedObjects = JSON.parse(callresult.result);

    for (let item of savedObjects) {
      if (JSON.stringify(item.userData) === JSON.stringify(currentUser)) {
        let drawnObject = item.userInfo;
        for (let key in drawnObject) {
          if (key === 'pl') {
            plot.X = drawnObject[key].X;
            plot.Y = drawnObject[key].Y;
            plot.W = drawnObject[key].W;
            plot.H = drawnObject[key].H;
            plot.ratio = drawnObject[key].ratio;
            plot.scale = drawnObject[key].scale;
          } else if (key === 'path') {
            for (let item of drawnObject[key]) {
              item.pattern = new Image();
              item.pattern.onload = function () {
                drawPath(item);
              };
              item.pattern.src = `./img/pathway/${item.number}.png`;
              ways.push(item);
            }
          } else {
            addImage(
              drawnObject[key][0],
              drawnObject[key][1],
              drawnObject[key][2],
              drawnObject[key][3],
              drawnObject[key][4],
              drawnObject[key][5],
              drawnObject[key][6],
              drawnObject[key][7],
              drawnObject[key][8]
            );
          }
        }
      }
    }
  }
  reDraw();
}

function errorHandler(jqXHR, statusStr, errorStr) {
  alert(statusStr + ' ' + errorStr);
}
